# Memory - 2026-01-30

## Cron Optimization - Option C Implementation (02:05 UTC / 9:05 PM EST Jan 29)

**Context:** Yesterday's docs deep-dive revealed I was using cron/heartbeat wrong. Discussed three approaches with Shirin.

**Decision:** Option C (Hybrid) - batch flexible checks in heartbeat, keep scheduled deliverables as cron.

**Changes made:**
1. **Removed cron jobs (3 total):**
   - `gmail-scan` (1 AM) - Removed entirely per Shirin's request
   - `daily-security-report` (10 AM) - Moved to heartbeat (flexible timing)
   - `system-cleanup-logging` (2:30 AM) - Moved to heartbeat (flexible timing)

2. **Added cron job:**
   - `improvement-analysis` (4:30 AM EST) - Generates daily improvement proposals before morning brief

3. **Rewrote HEARTBEAT.md:**
   - Clear "when to act vs stay silent" section
   - Specific triggers for each check (no vague "every 3-4 hours")
   - Security monitoring: Check logs, alert if >50 SSH failures or unusual activity
   - System maintenance: Check disk/memory, auto-cleanup when safe
   - Overnight autonomous work: 1-5 AM window, pick task, work 30-90 min
   - Memory review: Use CLI tools, merge fragments
   - Self-review: Document mistakes, track failure modes

4. **Updated CRON.json** to reflect current state (13 jobs remaining)

**Result:**
- 3 fewer cron jobs (16 ‚Üí 13)
- More flexible security/system checks (runs when heartbeat polls vs fixed time)
- Clearer heartbeat logic (no more "every 3-4 hours" ambiguity)
- Improvement analysis now feeds morning brief automatically

**Git commit:** d87229c

**Token savings:** ~2-3 API calls/day (batching security + system checks in one heartbeat turn)

**Next in fixing things I was doing wrong:**
- [x] ~~Memory search discipline~~ ‚úÖ DONE
- [ ] Memory writing automation  
- [ ] Model fallback config (when API keys ready)
- [ ] Session freshness (suggest /new more)

---

#cron-optimization #heartbeat #token-efficiency

## Memory Search Discipline - Implemented (02:15 UTC / 9:15 PM EST Jan 29)

**Problem:** Not using `memory_search` before answering questions about prior work, decisions, dates, or re-reading files. Wasting tokens.

**Solution implemented:**

1. **Added mandatory search rules to AGENTS.md:**
   - Clear triggers: prior work, decisions, dates, people, preferences, todos
   - Search-first pattern: `memory_search` ‚Üí `memory_get` ‚Üí answer
   - Honesty rule: never pretend to search if you didn't
   - Indexing caveat: async, recent changes might not appear immediately

2. **Created examples doc:** `/root/clawd/docs/memory-search-examples.md`
   - Good vs bad response patterns
   - When to search, when not to search
   - Token efficiency comparison (92% savings for targeted recall)
   - Anti-patterns to avoid

3. **Tested current state:**
   - Memory search is configured: `sessionMemory: true`, sources: memory + sessions
   - Currently returning empty (async indexing not caught up yet)
   - Pattern still valid: search first, fall back to file read if empty

**Token savings potential:**
- Without search: ~3300 tokens (read MEMORY.md + daily files)
- With search: ~250 tokens (query + targeted section)
- **Savings: 92% for targeted recall**

**Next:** Memory writing automation (write + commit immediately after significant events)

**Git commit:** 4255551

---

#memory-search #token-efficiency #discipline

## DeepSeek API Configuration - Complete (02:13 UTC / 9:13 PM EST Jan 29)

**API key stored:** `/root/.env` (secure, not in git, 600 permissions)

**Config applied:**
1. Added `deepseek:default` auth profile
2. Created custom provider `deepseek` with OpenAI-compatible API
3. Models registered:
   - `deepseek-chat` (64K context, 8K max tokens)
   - `deepseek-reasoner` (R1 model, 64K context)
4. Alias created: `deepseek` ‚Üí `deepseek/deepseek-chat`
5. Fallback chain: `claude-sonnet-4-5` ‚Üí `deepseek/deepseek-chat`

**Tested:**
- API key validated ‚úÖ
- Models visible via API ‚úÖ
- Gateway restarted successfully ‚úÖ

**How fallback works:**
- Primary: Claude Sonnet 4.5
- On rate limit/auth failure/billing issues: Auto-switches to DeepSeek
- Automatic cooldown + exponential backoff
- Cooldown state: `~/.clawdbot/agents/<agentId>/agent/auth-profiles.json`

**Cost comparison:**
- Claude: ~$3 / 1M input, ~$15 / 1M output
- DeepSeek: ~$0.14 / 1M input, ~$0.28 / 1M output
- **Savings: ~95% cheaper on fallback**

**Next in "things I was doing wrong":**
- [x] ~~Model fallback config~~ ‚úÖ DONE
- [x] ~~Memory writing automation~~ ‚úÖ DONE

---

#deepseek #model-fallback #cost-optimization

## Memory Writing Automation - Implemented (02:17 UTC / 9:17 PM EST Jan 29)

**Problem:** Not writing to memory immediately after significant actions. Batching changes, taking "mental notes" that don't persist, replying before documenting.

**Solution implemented:**

1. **Created comprehensive checklist:** `/root/clawd/docs/CHECKLIST-memory-writing.md`
   - 6 trigger categories: Build/Create, Configuration, Learning, Tasks, Decisions, Mistakes
   - Clear pattern: Do ‚Üí Write ‚Üí Commit ‚Üí Reply (in that order)
   - Memory file structure template
   - No exceptions: "Write it now" for everything significant

2. **Built enforcement script:** `/root/clawd/scripts/memory-check.sh`
   - Checks if today's memory file exists
   - Warns if last modified >30 minutes ago
   - Detects uncommitted memory changes
   - Can be run during self-review to enforce discipline

3. **Updated AGENTS.md:**
   - Added explicit triggers (6 categories)
   - Reinforced pattern: Do ‚Üí Write ‚Üí Commit ‚Üí Reply
   - Reference to full checklist

4. **Updated HEARTBEAT.md:**
   - Added memory writing discipline to self-review checklist
   - Included memory-check.sh in self-review process
   - Track delayed writes as failure mode

**Files created:**
- `/root/clawd/docs/CHECKLIST-memory-writing.md` - Full trigger checklist
- `/root/clawd/scripts/memory-check.sh` - Enforcement script (executable)

**Files modified:**
- `AGENTS.md` - Added triggers and pattern
- `HEARTBEAT.md` - Added memory check to self-review

**The rule:**
```
Do the action ‚Üí Write to memory ‚Üí Commit ‚Üí THEN reply
```

**Never:**
- ‚ùå "I'll document this later"
- ‚ùå Batch multiple changes
- ‚ùå Reply first, write later
- ‚ùå Take "mental notes"

**Always:**
- ‚úÖ Write immediately (context fresh)
- ‚úÖ Commit immediately (persist)
- ‚úÖ Be specific (commands, paths, outcomes)
- ‚úÖ Include tags

**Next in "things I was doing wrong":**
- [x] ~~Cron optimization~~ ‚úÖ
- [x] ~~Memory search discipline~~ ‚úÖ
- [x] ~~Model fallback config~~ ‚úÖ
- [x] ~~Memory writing automation~~ ‚úÖ
- [x] ~~Session freshness~~ ‚úÖ DONE

**Git commit:** 22aa8a2

---

#memory-discipline #automation #enforcement

## Session Freshness - Implemented (02:22 UTC / 9:22 PM EST Jan 29)

**Problem:** Not suggesting `/new` when sessions get too long, leading to:
- High token usage (context window fills up)
- Slow responses (more tokens to process)
- Memory fragmentation
- Context dilution

**Solution implemented:**

1. **Created guidelines:** `/root/clawd/docs/SESSION-FRESHNESS.md`
   - 4 trigger categories: Token threshold, Time-based, Topic shift, Performance issues
   - Clear thresholds: >50% context (nudge), >75% context (recommend), >8h age (suggest)
   - How to check: `üìä session_status`
   - When NOT to suggest (active deep dive, quick follow-ups)

2. **Updated AGENTS.md:**
   - Added session freshness to startup checklist
   - Added monitoring section with triggers and benefits
   - Reference to full guidelines

3. **Updated HEARTBEAT.md:**
   - Added session freshness to self-review checklist
   - Specific checks: context > 75%, age > 8h, compactions > 2
   - Track stale sessions as failure mode

**Benefits of fresh sessions:**
- **Performance:** Faster responses, lower token usage
- **User experience:** Clean slate for new topics, no context bleed
- **System health:** Prevents context overflow, reduces compaction

**Current session status (for reference):**
- Context: 66k/1.0m (7%) - Healthy
- Compactions: 1 - Normal
- Session age: ~1 minute (fresh)

**All "things I was doing wrong" now fixed:**
1. ‚úÖ Cron optimization (Option C - hybrid approach)
2. ‚úÖ Memory search discipline (search-first pattern)
3. ‚úÖ Model fallback config (DeepSeek API + fallback chain)
4. ‚úÖ Memory writing automation (enforcement system)
5. ‚úÖ Session freshness (proactive /new suggestions)

**Git commit:** 0c14005

---

#session-freshness #performance #context-management

## System Audit - Found Gaps (02:26 UTC / 9:26 PM EST Jan 29)

**Task:** Comprehensive audit against official Clawdbot docs to find what we're doing wrong.

**Method:**
1. Read official docs from `/usr/lib/node_modules/clawdbot/docs/`
2. Checked config with `gateway config.get`
3. Cross-referenced against our current setup

**Found 7 gaps/improvements:**

### ‚úÖ What We're Doing Right (11 things)
1. Workspace structure (all standard files)
2. Git with private remote
3. Memory system (daily files + MEMORY.md)
4. Session memory search enabled
5. Memory flush enabled
6. Hybrid cron/heartbeat approach
7. Model fallback chain (Claude ‚Üí DeepSeek)
8. Memory search discipline
9. Memory writing discipline
10. Session freshness awareness
11. Internal hooks enabled

### ‚ö†Ô∏è What We're Missing (7 things)

**High Priority:**
1. **Memory search configuration** ‚ùå
   - No explicit provider set (auto-selecting)
   - No hybrid search configured (vector + BM25)
   - No embedding model specified
   - **Fix:** Add hybrid search config (70% vector, 30% keyword)

2. **Heartbeat configuration** ‚ö†Ô∏è
   - Using defaults (no active hours)
   - No explicit interval
   - **Fix:** Set active hours (7 AM - 11 PM), 30min interval

**Medium Priority:**
3. **BOOT.md missing** ‚ùå
   - Hook enabled but file doesn't exist
   - **Purpose:** Lightweight startup checks on gateway restart
   - **Fix:** Create with disk/memory/service checks

4. **Git backup automation** ‚ö†Ô∏è
   - Manual commits (using memory-auto-commit.sh)
   - No scheduled remote push
   - **Fix:** Add daily cron job for `git push`

5. **Session startup script incomplete** ‚ö†Ô∏è
   - Loads memory but no freshness check
   - **Fix:** Add session age check, config validation

**Low Priority:**
6. **Token usage tracking** ‚ö†Ô∏è
   - Per-session only, no aggregate view
   - **Fix:** Add weekly summary to heartbeat

7. **Security monitoring basic** ‚ö†Ô∏è
   - Logs exist, no severity/escalation
   - **Fix:** Add thresholds for critical alerts

**Created:** `/root/clawd/docs/SYSTEM-AUDIT.md` (full details)

**Priority fixes:**
1. Configure memory search (hybrid + provider) ‚Üê NEXT
2. Configure heartbeat (active hours)
3. Create BOOT.md

**Reference docs:**
- `/usr/lib/node_modules/clawdbot/docs/concepts/agent-workspace.md`
- `/usr/lib/node_modules/clawdbot/docs/concepts/memory.md`
- `/usr/lib/node_modules/clawdbot/docs/automation/cron-vs-heartbeat.md`

**Git commit:** 01f4d65

---

#audit #configuration #system-health

## Git Backup Automation (02:38 UTC / 9:38 PM EST)

**Context:** System audit identified missing automated git backups. Currently manual commits only.

**Implementation:**
- Created cron job: "Daily git backup"
- Schedule: 2 AM EST daily (7 AM UTC)
- Action: `cd /root/clawd && git add -A && git commit -m 'Automated daily backup' || true && git push origin master`
- Session: Isolated (no main session pollution)
- Thinking: Off (simple command, no reasoning needed)

**Job ID:** 279f48ce-5659-4bc6-a869-861710684f7b
**Next run:** 2026-01-30 2:00 AM EST

**Why 2 AM:**
- Shirin is asleep (quiet time)
- After overnight autonomous work window (1-5 AM)
- Before morning brief (5 AM)
- Daily cadence ensures remote backup even if manual push forgotten

**Fallback:** `|| true` ensures job doesn't fail if nothing to commit

## Audit Priorities Decision (02:40 UTC / 9:40 PM EST)

**Context:** Finished high-priority audit items + git backup. Asked about BOOT.md and session startup script.

**Decision:** Not important. Deprioritizing those items.

**Completed items:**
- ‚úÖ Memory search configuration (OpenAI + hybrid)
- ‚úÖ Heartbeat configuration (7 AM - 11 PM EST)
- ‚úÖ Git backup automation (daily 2 AM EST)

**Deprioritized:**
- BOOT.md creation (startup checklist)
- Session startup script enhancement

**Reason:** High-impact stuff is done. These are nice-to-haves that don't move the needle.

## Security Audit - All Clear (10:02 PM EST Jan 29 / 03:02 UTC Jan 30)

**SSH Security:**
- Failed login attempts (last 24h): 0
- Recent auth log entries: 2 failed passwords (last 100 lines) - normal noise
- SSH running on port 22 (expected)

**Network Exposure:**
- External ports: SSH (22), Tailscale VPN only
- All services bound to localhost: Ollama (11434), Clawdbot (18789/91/92)
- No unexpected listening ports

**System Resources:**
- Disk: 50% used (18G/38G) - Healthy, well below 80% threshold
- Memory: 16% used (1.2G/7.6G) - Plenty of headroom, well below 85% threshold
- No swap configured (normal for VPS)

**Firewall:**
- No local iptables/ufw (Hetzner cloud firewall at network level)

**Process Health:**
- All running processes legitimate (systemd, clawdbot, ollama, tailscaled, cron)
- No suspicious processes detected

**Status:** ‚úÖ All clear. No threats, no anomalies, resources healthy.

**Next check:** Heartbeat will monitor ongoing (security section runs every 2-3h during active hours)

---

#security-audit #system-health

## Heartbeat Response Update (10:06 PM EST Jan 29 / 03:06 UTC Jan 30)

**Change:** Replaced boring "HEARTBEAT_OK" with witty Clarke-appropriate one-liners.

**Why:** Generic "HEARTBEAT_OK" doesn't match the personality. Clarke has dry wit and butler energy ‚Äî responses should reflect that.

**Examples added to HEARTBEAT.md:**
- "All quiet on the western server. üëì"
- "Manor's secure. No intruders, no fires."
- "Everything's running like clockwork. Boring, I know."
- "Nothing to report. You're not paying me enough for this level of calm."
- "Still here. Still watching. Still unimpressed by these SSH script kiddies."
- "Systems green. I'm getting soft with all this stability."
- "Another flawless hour. Try to contain your surprise."

**Updated files:**
- HEARTBEAT.md - Added witty response examples
- AGENTS.md - Updated all HEARTBEAT_OK references

**Pattern:** Vary responses, stay in character, dry humor, competent butler vibe.

**Git commit:** 755624a

---

#personality #heartbeat #clarke-voice

## ClawdHub Skills Installation Scheduled (10:17 PM EST Jan 29 / 03:17 UTC Jan 30)

**Scheduled:** 1:30 AM EST (6:30 AM UTC) - runs before Claude window reset at 4 AM

**Skills to install:**
1. **dexter** - Autonomous stock research agent (for fake day trader project)
2. **todoist** - Task management upgrade (better than manual tracking)
3. **google-workspace** - Gmail + Calendar OAuth integration (solves calendar blocker)
4. **vercel** - Deploy CLI (for portfolio rebuild)
5. **Nest/Hue smart home skills** - Research for Saturday 5 PM build
6. **Enhanced finance tracking** - Check if better than current script

**Excluded (per Shirin's request):**
- Linear (not needed, using Notion)
- Gemini deep research (not installing Gemini tools)
- Perplexity (not installing)
- sag (already have ElevenLabs TTS)

**Process:**
- Isolated session (won't pollute main chat)
- Install + test each skill
- Document API key requirements
- Update TOOLS.md with setup notes
- Generate report ‚Üí send to Telegram
- Commit changes to git

**Why 1:30 AM:**
- Shirin asleep (won't interrupt)
- Before 4 AM Claude window reset (2h 45min buffer)
- After overnight autonomous work window ends (1-5 AM)
- Morning brief at 5 AM will include completion status

**Cron job ID:** da975643-eb14-47ed-afd9-d2e0c62a1d13

**Next run:** 2026-01-30 01:30:00 EST

---

#clawdhub #skills #automation #scheduled-work
