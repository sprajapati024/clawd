# 2026-01-30 · SSH Lockdown + Troubleshooting

## SSH Issue + Resolution
- **Problem:** SSH to VPS timing out on port 22
- **Root cause:** Hetzner Cloud Firewall had no inbound rule for TCP 22
- **Initial confusion:** Tried to use private Tailscale IP (100.103.14.127) from public internet → timeout
- **Secondary confusion:** ExpressVPN blocking SSH traffic intermittently
- **Solution path:**
  1. Opened port 22 at Hetzner firewall temporarily (0.0.0.0/0)
  2. Created `shirin` user with SSH key
  3. Set up passwordless sudo for shirin
  4. Disabled root SSH (`PermitRootLogin no`)
  5. Closed public port 22 in Hetzner firewall
  6. SSH now only accessible via Tailscale (100.103.14.127)

## Key Learnings
- **Hetzner firewall is outside the OS** — sshd config can't fix provider-level blocks
- **ExpressVPN is terrible for SSH** — blocks/rate-limits port 22, dynamic IPs cause lockouts
- **Tailscale is the correct answer** — private mesh, no IP lockout risk, works with VPN off
- **100.x.x.x IPs:** 
  - 100.64.0.0/10 = CGNAT (Hetzner private network)
  - 100.x.x.x in Tailscale = also private but different space
- **User setup:** SSH key must exist in `~/.ssh/authorized_keys` with correct perms (600, owned by user)

## TUI Troubleshooting (important)
- **TUI is NOT a standalone chat interface**
- TUI only attaches to existing agent sessions (requires `--to`, `--session-id`, or `--agent`)
- Cannot auto-spawn an interactive agent for TUI — not supported by Clawdbot CLI
- Attempted workarounds (wrapper scripts, backgrounding agents) all failed
- **Correct usage:** Telegram for chat, TUI for monitoring/diagnostics only
- **Decision:** Abandon TUI-as-chat-surface, use Telegram as primary

## Final Security Posture
- ✅ Root SSH disabled
- ✅ SSH only via Tailscale (private mesh)
- ✅ Public port 22 closed at Hetzner firewall
- ✅ User `shirin` with passwordless sudo
- ✅ fail2ban active (10 IPs already banned)
- ✅ Password auth disabled (keys only)
- ✅ Clawdbot runs as root (unaffected by user changes)

## Model Strategy
- **Default:** Sonnet (anthropic/claude-sonnet-4-5)
- **On-demand:** DeepSeek (coding), GPT-5.2 (general)
- Reasoning: Sonnet best for planning/judgment, switches available per task

## Self-Review
- **Mistake:** Didn't write to memory during the work — only after Shirin asked
- **Pattern:** Need to write IMMEDIATELY after significant actions, not batch at end
- **Trigger:** Run `/root/clawd/scripts/memory-auto-commit.sh` after writes
